---

## Python setup


```python
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
import altair as alt
import plotly
import plotly.express as px
import os

if not os.path.exists('img'):
    os.makedirs('img')

from IPython.display import IFrame, display_html
def show_fig(fig, filename, width="100%", height=500):
    plotly.offline.plot(fig, filename=filename, auto_open=False, auto_play=False)
    display_html(IFrame(filename, height=height, width=width))

def show_fig2(filename, width="100%", height=500):
    display_html(IFrame(filename, width=width, height=height))
```

---
class:middle,center,inverse

# Heatmaps

---

## Heatmaps

Heatmaps are a common 2-dimensional colored grid that is used for visualizing intensity or level of a variable across levels of two other variables.

It is commonly used in bioinformatics to display expression levels of genes across samples, often in conjunction with some cluster analysis to put
like genes/samples next to each other for visualization purposes

Heatmaps can be drawn using all the packages we have seen in this class. 


---

## Example data

We'll use average monthly temperatures in Washington, DC in 1971-2020, obtained from the National Weather Service ([link](https://w2.weather.gov/climate/xmacis.php?wfo=lwx)).

.footnote[This data was extracted using the R package `datapasta`]


```python
import pandas as pd

dc_weather = pd.read_csv('data/dc_weather.csv')
dc_weather.drop('Annual', axis=1, inplace=True) # Remove the 'Annual' column
dc_weather.set_index('Year', inplace=True)
dc_weather = dc_weather.T
dc_weather.index.name='Month'
```

---

## Weather data: Seaborn


```python
fig, ax = plt.subplots(figsize = (15,5))
sns.heatmap(dc_weather, cmap="inferno", cbar_kws={'shrink':0.8, 'label': 'Degrees (F)'}, ax=ax);

ax.set_yticklabels(ax.get_yticklabels(), rotation = 0, horizontalalignment='right');
ax.set_xticklabels(ax.get_xticklabels(), rotation = 45, horizontalalignment='right');
ax.set_title('Average monthly temperature in Washington DC (1971-2020)', loc='left');
fig.savefig('img/temp_sns.html')
show_fig2('img/temp_sns.html')


```


    
![svg](week6_heatmap_files/week6_heatmap_5_0.svg)
    


---

## Weather data: matplotlib


```python
fig, ax = plt.subplots(figsize=(15,5))
im= ax.imshow(dc_weather.values, cmap='inferno')
cbar = ax.figure.colorbar(im, ax=ax)
cbar.ax.set_ylabel('Degrees (F)', rotation=90, va='bottom');
ax.set_xticks(np.arange(dc_weather.shape[1]))
ax.set_yticks(np.arange(dc_weather.shape[0]))
ax.set_xticklabels(dc_weather.columns.values, rotation=45, horizontalalignment='right')
ax.set_yticklabels(dc_weather.index.values);
ax.set_title('Average monthly temperature in Washington DC (1971-2020)', loc='left');
fig.savefig('img/temp_mpl.html')
show_fig2('img/temp_mpl.html')
```


    
![svg](week6_heatmap_files/week6_heatmap_7_0.svg)
    


---

## Weather data: Plotly express


```python
fig = px.imshow(dc_weather, labels = dict(color='Temperature (F)'))
show_fig(fig, 'img/temp_plotly.html')
```

<iframe src = "img/temp_plotly.html" width="100%" height=400></iframe>

---

## Weather data: altair


```python
D = dc_weather.reset_index().melt(id_vars='Month', value_name='Avg Temp')
D['Month'] = pd.Categorical(D['Month'], categories = dc_weather.index)
alt.Chart(D).mark_rect().encode(
    x = 'Year:N', # Make year nominal so it is treated as a discrete variable
    y = alt.Y('Month:N', bin=False, sort=None),
    color = alt.Color('Avg Temp:Q', scale = alt.Scale(scheme='inferno')),
    tooltip = ['Month','Year','Avg Temp']
).save('img/temp_alt.html')
show_fig2('img/temp_alt.html')
```





<iframe src='img/temp_alt.html' width="100%" height=400></iframe>


---
class:middle,center,inverse

# Adding clustering

---

## Re-ordering rows and columns

In many contexts, especially bioinformatics, heatmaps are used to display similarities between units, using cluster analysis. Typically hierarchical clustering is used.

We will use a breast cancer data set, and look to see if there are individuals who have similar profiles across the variables recorded, and if that might be related to outcome.



```python
from sklearn.datasets import load_breast_cancer
bc_data = load_breast_cancer()
data = pd.DataFrame(bc_data.data, columns = bc_data.feature_names)
data.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean radius</th>
      <th>mean texture</th>
      <th>mean perimeter</th>
      <th>mean area</th>
      <th>mean smoothness</th>
      <th>mean compactness</th>
      <th>mean concavity</th>
      <th>mean concave points</th>
      <th>mean symmetry</th>
      <th>mean fractal dimension</th>
      <th>radius error</th>
      <th>texture error</th>
      <th>perimeter error</th>
      <th>area error</th>
      <th>smoothness error</th>
      <th>compactness error</th>
      <th>concavity error</th>
      <th>concave points error</th>
      <th>symmetry error</th>
      <th>fractal dimension error</th>
      <th>worst radius</th>
      <th>worst texture</th>
      <th>worst perimeter</th>
      <th>worst area</th>
      <th>worst smoothness</th>
      <th>worst compactness</th>
      <th>worst concavity</th>
      <th>worst concave points</th>
      <th>worst symmetry</th>
      <th>worst fractal dimension</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>17.99</td>
      <td>10.38</td>
      <td>122.80</td>
      <td>1001.0</td>
      <td>0.11840</td>
      <td>0.27760</td>
      <td>0.3001</td>
      <td>0.14710</td>
      <td>0.2419</td>
      <td>0.07871</td>
      <td>1.0950</td>
      <td>0.9053</td>
      <td>8.589</td>
      <td>153.40</td>
      <td>0.006399</td>
      <td>0.04904</td>
      <td>0.05373</td>
      <td>0.01587</td>
      <td>0.03003</td>
      <td>0.006193</td>
      <td>25.38</td>
      <td>17.33</td>
      <td>184.60</td>
      <td>2019.0</td>
      <td>0.1622</td>
      <td>0.6656</td>
      <td>0.7119</td>
      <td>0.2654</td>
      <td>0.4601</td>
      <td>0.11890</td>
    </tr>
    <tr>
      <th>1</th>
      <td>20.57</td>
      <td>17.77</td>
      <td>132.90</td>
      <td>1326.0</td>
      <td>0.08474</td>
      <td>0.07864</td>
      <td>0.0869</td>
      <td>0.07017</td>
      <td>0.1812</td>
      <td>0.05667</td>
      <td>0.5435</td>
      <td>0.7339</td>
      <td>3.398</td>
      <td>74.08</td>
      <td>0.005225</td>
      <td>0.01308</td>
      <td>0.01860</td>
      <td>0.01340</td>
      <td>0.01389</td>
      <td>0.003532</td>
      <td>24.99</td>
      <td>23.41</td>
      <td>158.80</td>
      <td>1956.0</td>
      <td>0.1238</td>
      <td>0.1866</td>
      <td>0.2416</td>
      <td>0.1860</td>
      <td>0.2750</td>
      <td>0.08902</td>
    </tr>
    <tr>
      <th>2</th>
      <td>19.69</td>
      <td>21.25</td>
      <td>130.00</td>
      <td>1203.0</td>
      <td>0.10960</td>
      <td>0.15990</td>
      <td>0.1974</td>
      <td>0.12790</td>
      <td>0.2069</td>
      <td>0.05999</td>
      <td>0.7456</td>
      <td>0.7869</td>
      <td>4.585</td>
      <td>94.03</td>
      <td>0.006150</td>
      <td>0.04006</td>
      <td>0.03832</td>
      <td>0.02058</td>
      <td>0.02250</td>
      <td>0.004571</td>
      <td>23.57</td>
      <td>25.53</td>
      <td>152.50</td>
      <td>1709.0</td>
      <td>0.1444</td>
      <td>0.4245</td>
      <td>0.4504</td>
      <td>0.2430</td>
      <td>0.3613</td>
      <td>0.08758</td>
    </tr>
    <tr>
      <th>3</th>
      <td>11.42</td>
      <td>20.38</td>
      <td>77.58</td>
      <td>386.1</td>
      <td>0.14250</td>
      <td>0.28390</td>
      <td>0.2414</td>
      <td>0.10520</td>
      <td>0.2597</td>
      <td>0.09744</td>
      <td>0.4956</td>
      <td>1.1560</td>
      <td>3.445</td>
      <td>27.23</td>
      <td>0.009110</td>
      <td>0.07458</td>
      <td>0.05661</td>
      <td>0.01867</td>
      <td>0.05963</td>
      <td>0.009208</td>
      <td>14.91</td>
      <td>26.50</td>
      <td>98.87</td>
      <td>567.7</td>
      <td>0.2098</td>
      <td>0.8663</td>
      <td>0.6869</td>
      <td>0.2575</td>
      <td>0.6638</td>
      <td>0.17300</td>
    </tr>
    <tr>
      <th>4</th>
      <td>20.29</td>
      <td>14.34</td>
      <td>135.10</td>
      <td>1297.0</td>
      <td>0.10030</td>
      <td>0.13280</td>
      <td>0.1980</td>
      <td>0.10430</td>
      <td>0.1809</td>
      <td>0.05883</td>
      <td>0.7572</td>
      <td>0.7813</td>
      <td>5.438</td>
      <td>94.44</td>
      <td>0.011490</td>
      <td>0.02461</td>
      <td>0.05688</td>
      <td>0.01885</td>
      <td>0.01756</td>
      <td>0.005115</td>
      <td>22.54</td>
      <td>16.67</td>
      <td>152.20</td>
      <td>1575.0</td>
      <td>0.1374</td>
      <td>0.2050</td>
      <td>0.4000</td>
      <td>0.1625</td>
      <td>0.2364</td>
      <td>0.07678</td>
    </tr>
  </tbody>
</table>
</div>



---

## breast cancer: creating the heatmap

In **seaborn**, the `clustermap` function takes care of the clustering for us. Note that we are scaling the rows so that they have mean 0 and variance 1, to enable a better view of the differences in patterns. We are also using the correlation metric (1 - correlation) to cluster rows and columns.

.pull-left[
```python
fig = sns.clustermap(data, 
  standard_scale=1, metric='correlation', 
  method='average',cmap='RdBu',);
fig.savefig('img/heatmap_cluster1.png')
show_fig2('img/heatmap_cluster1.png')
```
]
.pull-right[

<iframe
    width="100%"
    height="500"
    src="img/heatmap_cluster1.png"
    frameborder="0"
    allowfullscreen
></iframe>


]

    
![svg](week6_heatmap_files/week6_heatmap_15_2.svg)
    


---

## breast cancer: adding to the heatmap

We will add a column to the heatmap that color-codes the outcomes, so we can see if the clustering aligns with the outcomes.


```python
color_dict = dict(zip(np.unique(bc_data.target), np.array(['g','skyblue'])))
target_df = pd.DataFrame({'target': bc_data.target})
row_colors = target_df.target.map(color_dict)
```

---

## breast cancer: adding to the heatmap

.pull-left[
```python
sns.clustermap(data, standard_scale=1, 
  metric='correlation', method='average', 
  cmap = 'RdBu',row_colors=row_colors);
```
]
.pull-right[
    
![svg](week6_heatmap_files/week6_heatmap_19_1.svg)
    
]

---
class:middle,center,inverse

# Embellishing the heatmap

---

## Adding marginal histograms and annotation

We will use a data set of measles cases in the US from 1930 to 2000 to demonstrate how to create marginal histograms around a heatmap. 

We can first read in the data and do a bit of data munging.


```python
measles = pd.read_csv('data/measles.csv')
measles['state'] = measles['state'].str.title().str.replace('.', ' ')
measles = measles.set_index('state')
measles.head()
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>1930</th>
      <th>1931</th>
      <th>1932</th>
      <th>1933</th>
      <th>1934</th>
      <th>1935</th>
      <th>1936</th>
      <th>1937</th>
      <th>1938</th>
      <th>1939</th>
      <th>1940</th>
      <th>1941</th>
      <th>1942</th>
      <th>1943</th>
      <th>1944</th>
      <th>1945</th>
      <th>1946</th>
      <th>1947</th>
      <th>1948</th>
      <th>1949</th>
      <th>1950</th>
      <th>1951</th>
      <th>1952</th>
      <th>1953</th>
      <th>1954</th>
      <th>1955</th>
      <th>1956</th>
      <th>1957</th>
      <th>1958</th>
      <th>1959</th>
      <th>1960</th>
      <th>1961</th>
      <th>1962</th>
      <th>1963</th>
      <th>1964</th>
      <th>1965</th>
      <th>1966</th>
      <th>1967</th>
      <th>1968</th>
      <th>1969</th>
      <th>1970</th>
      <th>1971</th>
      <th>1972</th>
      <th>1973</th>
      <th>1974</th>
      <th>1975</th>
      <th>1976</th>
      <th>1977</th>
      <th>1978</th>
      <th>1979</th>
      <th>1980</th>
      <th>1981</th>
      <th>1982</th>
      <th>1983</th>
      <th>1984</th>
      <th>1985</th>
      <th>1986</th>
      <th>1987</th>
      <th>1988</th>
      <th>1989</th>
      <th>1990</th>
      <th>1991</th>
      <th>1992</th>
      <th>1993</th>
      <th>1994</th>
      <th>1995</th>
      <th>1996</th>
      <th>1997</th>
      <th>1998</th>
      <th>1999</th>
      <th>2000</th>
      <th>2001</th>
    </tr>
    <tr>
      <th>state</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Alabama</th>
      <td>4389</td>
      <td>8934</td>
      <td>270</td>
      <td>1735</td>
      <td>15849</td>
      <td>7214</td>
      <td>572</td>
      <td>620</td>
      <td>13511</td>
      <td>4381</td>
      <td>3052</td>
      <td>8696</td>
      <td>3564</td>
      <td>3865</td>
      <td>7199</td>
      <td>339</td>
      <td>3986</td>
      <td>3693</td>
      <td>2058</td>
      <td>11066</td>
      <td>1503</td>
      <td>3144</td>
      <td>11878</td>
      <td>2799</td>
      <td>8451</td>
      <td>2061</td>
      <td>7117</td>
      <td>9264</td>
      <td>7664</td>
      <td>3467</td>
      <td>2075</td>
      <td>2588</td>
      <td>2379</td>
      <td>1165</td>
      <td>18140</td>
      <td>2346</td>
      <td>1813</td>
      <td>1345</td>
      <td>158</td>
      <td>12</td>
      <td>486</td>
      <td>2086</td>
      <td>142</td>
      <td>19</td>
      <td>21</td>
      <td>5</td>
      <td>0</td>
      <td>79</td>
      <td>60</td>
      <td>94</td>
      <td>22</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>0</td>
      <td>14</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>6</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Alaska</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1487</td>
      <td>536</td>
      <td>2511</td>
      <td>958</td>
      <td>1259</td>
      <td>1829</td>
      <td>1456</td>
      <td>1002</td>
      <td>1406</td>
      <td>1849</td>
      <td>1169</td>
      <td>215</td>
      <td>641</td>
      <td>148</td>
      <td>4</td>
      <td>22</td>
      <td>73</td>
      <td>40</td>
      <td>7</td>
      <td>5</td>
      <td>1</td>
      <td>0</td>
      <td>11</td>
      <td>49</td>
      <td>2</td>
      <td>18</td>
      <td>4</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>6</td>
      <td>1</td>
      <td>7</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>American Samoa</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Arizona</th>
      <td>2107</td>
      <td>2135</td>
      <td>86</td>
      <td>1261</td>
      <td>1022</td>
      <td>586</td>
      <td>2378</td>
      <td>3793</td>
      <td>604</td>
      <td>479</td>
      <td>2078</td>
      <td>2929</td>
      <td>3813</td>
      <td>1002</td>
      <td>4641</td>
      <td>332</td>
      <td>3274</td>
      <td>1464</td>
      <td>4303</td>
      <td>3795</td>
      <td>2389</td>
      <td>10454</td>
      <td>2515</td>
      <td>4934</td>
      <td>4959</td>
      <td>10086</td>
      <td>6785</td>
      <td>7659</td>
      <td>9845</td>
      <td>9067</td>
      <td>4305</td>
      <td>7868</td>
      <td>6350</td>
      <td>8878</td>
      <td>6328</td>
      <td>1593</td>
      <td>5536</td>
      <td>1022</td>
      <td>243</td>
      <td>561</td>
      <td>1006</td>
      <td>515</td>
      <td>868</td>
      <td>11</td>
      <td>21</td>
      <td>83</td>
      <td>233</td>
      <td>242</td>
      <td>58</td>
      <td>84</td>
      <td>327</td>
      <td>7</td>
      <td>16</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>38</td>
      <td>6</td>
      <td>0</td>
      <td>1</td>
      <td>61</td>
      <td>52</td>
      <td>0</td>
      <td>3</td>
      <td>9</td>
      <td>12</td>
      <td>8</td>
      <td>9</td>
      <td>8</td>
      <td>1</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>Arkansas</th>
      <td>996</td>
      <td>849</td>
      <td>99</td>
      <td>5438</td>
      <td>7222</td>
      <td>1518</td>
      <td>107</td>
      <td>322</td>
      <td>6690</td>
      <td>1724</td>
      <td>1096</td>
      <td>5474</td>
      <td>4542</td>
      <td>2867</td>
      <td>3780</td>
      <td>1098</td>
      <td>3266</td>
      <td>2414</td>
      <td>3824</td>
      <td>12313</td>
      <td>1739</td>
      <td>7625</td>
      <td>2910</td>
      <td>13079</td>
      <td>2619</td>
      <td>2983</td>
      <td>8637</td>
      <td>1358</td>
      <td>3002</td>
      <td>816</td>
      <td>1596</td>
      <td>1684</td>
      <td>1438</td>
      <td>1453</td>
      <td>1108</td>
      <td>1195</td>
      <td>1379</td>
      <td>1269</td>
      <td>3</td>
      <td>3</td>
      <td>33</td>
      <td>447</td>
      <td>13</td>
      <td>37</td>
      <td>14</td>
      <td>2</td>
      <td>20</td>
      <td>8</td>
      <td>18</td>
      <td>10</td>
      <td>9</td>
      <td>14</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>0</td>
      <td>244</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>32</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>3</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>




```python
measles2 = measles.reset_index().melt(id_vars = 'state',var_name='Year', value_name='count') # Tidying the data
bl = measles2.groupby('state')['count'].sum()
ind = bl.argsort() # Find index order that makes the states ordered by total case
```


```python
---
class:middle,center,inverse

# Creating marginal frequency distributions
d1 = measles2.groupby('Year').sum().reset_index()
d2 = measles2.groupby('state').sum().reset_index().sort_values(by='count', ascending=False)
```

---

## measles: seaborn


```python
g = sns.JointGrid(ratio=8, height=10)
sns.heatmap(measles.iloc[ind[::-1],:], cmap='YlOrRd', linewidth=0.1,ax=g.ax_joint, cbar=False)
sns.barplot(x='count', y ='state', data=d2, color = 'yellow', ax = g.ax_marg_y)
sns.barplot(y='count', x = 'Year', data=d1, color='yellow', ax = g.ax_marg_x)
g.ax_joint.axvline(np.where(measles.columns=='1961'), linestyle='--')
g.ax_joint.set_xticks(np.arange(0,80,10))
g.ax_joint.set_xticklabels(np.arange(1930, 2005,10),rotation=45);
g.ax_joint.set_ylabel('');
g.ax_marg_x.text(31,100,'Vaccine introduced', horizontalalignment='center', fontsize='x-large');
g.fig.subplots_adjust(top=0.9)
g.fig.suptitle("Measles cases in the US, 1930-2001", fontsize='xx-large');   
g.fig.savefig('img/measles_sns.png')
```

---

## measles: seaborn
    
![svg](week6_heatmap_files/week6_heatmap_25_0.svg)
    
---

## measles: plotly

```python
import plotly.graph_objects as go
from plotly.subplots import make_subplots

fig1 = make_subplots(rows=2, cols=2, column_widths=[0.8, 0.2], row_heights=[0.2,0.8], horizontal_spacing=0.05, vertical_spacing=0.05)
fig1.add_trace(
    go.Heatmap(z = measles_px.values, x = measles_px.columns, y = measles_px.index, colorscale='ylorrd', showscale=False),
    row=2, col=1
)
fig1.add_trace(
    go.Bar(x = d1.Year, y = d1['count'].values, marker_color='orange')
)
fig1.add_trace(
    go.Bar(x = d2['count'].values, y = d2.state, orientation='h', marker_color='orange'),
    row=2,col=2,
)
fig1.add_shape(go.layout.Shape(type='line', x0=31, x1=31, y0 = -1, y1=56, line=dict(color='green', width=3, dash='dash')),row=2, col = 1, )
fig1.add_annotation(xref='x domain', yref='y domain', x = 0.45, y = 0.05, text = 'Vaccine available', showarrow=False, row=2, col=1,)
fig1.update_xaxes(showticklabels=False, row=1, col=1)
fig1.update_yaxes(showticklabels=False, row=2, col=2)
fig1.update_yaxes(row=2, col=1, autorange='reversed')
fig1.update_yaxes(row=2, col=2, autorange='reversed')
fig1.update_layout(showlegend=False, template = 'simple_white')
show_fig(fig1, 'img/measles_plotly.html')
```



<iframe
    width="100%"
    height="500"
    src="img/measles_plotly.html"
    frameborder="0"
    allowfullscreen
></iframe>


---

## measles: altair


```python
top_bar = alt.Chart(d1).mark_bar().encode(
    x = alt.X('Year', axis = alt.Axis(labels=False, title=None)),
    y = alt.Y('count', axis = alt.Axis(title=None, format='s')),
    tooltip = ['Year', alt.Tooltip('count', title="N", format='.3s')],
).properties(width=600, height=200).interactive()
side_bar = alt.Chart(d2).mark_bar().encode(
    y = alt.Y('state', sort=d2.state.values, axis = alt.Axis(labels=False, title=None)),
    x = alt.X('count', axis = alt.Axis(title=None, format='s')),
    tooltip = ['state',alt.Tooltip('count', title="N",format='.3s')],
).properties(width=200, height=600).interactive()

heatmap = alt.Chart(measles2).mark_rect().encode(
    x = 'Year', 
    y = alt.Y('state', sort = d2.state.values),
    color = alt.Color('count', scale=alt.Scale( scheme='yelloworangered')), 
    tooltip = [alt.Tooltip('state', title='State'),
            alt.Tooltip('Year', title='Year'),
            alt.Tooltip('count', title='N', format='.3s')],
).properties(width=600, height=600).interactive()
(top_bar & (heatmap | side_bar)).save('img/measles_alt.html')

```

---

## measles: altair




<iframe
    width="100%"
    height="80%"
    src="img/measles_alt.html"
    frameborder="0"
    allowfullscreen
></iframe>


